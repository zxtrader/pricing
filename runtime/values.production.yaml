zone: production

application:

  api:
    env:
      IdentityServerAuthentication__ValidIssuers: https://id.pay-cex.io
      WTFProviderConfigurationFile: /etc/cexiolabs/cexiopay.api/legacy-cpservice-config/WTF-prod.json

  echo:
    replicas: 0

  gatehostinternal:
    replicas: 0

  identity:
    env:
      Emailer__SendGrid__senderEmail: "no-reply@pay-cex.io"

  notifier:
    replicas: 1

  processing:
    args:
      [
        "--config-file=/etc/cexiolabs/cexiopay.processing/service.config",
        "--config-toml-file=/etc/cexiolabs/cexiopay.processing/service.toml",
        "--config-toml-file=/etc/cexiolabs/cexiopay.processing/service-setup.toml",
        "--config-toml-file=/etc/cexiolabs/cexiopay.processing/service-zone-production.toml",
        "--config-secrets-dir=/etc/cexiolabs/cexiopay/secrets",
        "--config-env"
      ]
    env:
      runtime.aggregator.ssl.caCert: "/etc/cexiolabs/cexiopay/trusted-aggregator-ca.crt"
      runtime.pss.messengerBridge.ssl.caCert: "/etc/cexiolabs/cexiopay/trusted-messenger-bridge-ca.crt"
      runtime.pss.cryptoWalletHelper.ssl.caCert: "/etc/cexiolabs/cexiopay/trusted-psscryptowallethelper-ca.crt"
      runtime.pss.providerWtf2.ssl.caCert: "/etc/cexiolabs/cexiopay/trusted-pss-provider-wtf2-ca.crt"
      runtime.endpoint.gateUi.bindPath: "/"
      setup.createCryptoWallet_indexer: ""
      setup.createExchange_indexer: ""
      setup.setMissingDepositTransaction_indexer: ""
      setup.setMissingWithdrawalTransaction_indexer: ""
      setup.subscribeNotification_indexer: ""


ingress:

  API:
    blue:
      domain: api.pay-cex.io
      certSecretName: ingress-pay-cex-certificate
    nginxConfigurationSnippet: |
      rewrite ^/$ /v2/time redirect;
    paths:
      "/":
        backendServiceName: processing
        backendServicePort: 8080
      "/v3/":
        backendServiceName: api
        backendServicePort: 8443

  API-Obsolete:
    blue:
      domain: api.cryptopay.band
      certSecretName: ingress-gate-api-dashboard
    nginxConfigurationSnippet: |
      rewrite ^/$ /v2/time redirect;
    paths:
      "/":
        backendServiceName: processing
        backendServicePort: 8080
      "/v2/gate/":
        backendServiceName: processing
        backendServicePort: 8085
      "/v3/":
        backendServiceName: api
        backendServicePort: 8443

  API-Internal:
    blue:
      domain: api.prodcryptopay.kube
      certSecretName: callback
    nonblue:
      # Make final domain "api-<HelmReleaseName>.prodcryptopay.kube" like a:
      #   api-green.prodcryptopay.kube
      domainPerfix: api-
      domainSuffix: .prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    nginxConfigurationSnippet: |
      rewrite ^/$ /v2/time redirect;
    paths:
      "/":
        backendServiceName: processing
        backendServicePort: 8080
      "/v2/gate/":
        backendServiceName: processing
        backendServicePort: 8085
      "/v3/":
        backendServiceName: api
        backendServicePort: 8443

  Board:
    nonblue:
      # Make final domain "board-<HelmReleaseName>.prodcryptopay.kube" like a:
      #   board-green.prodcryptopay.kube
      domainPerfix: board-
      domainSuffix: .prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    backendInsecure: false
    nginxConfigurationSnippet: |
      add_header Last-Modified $date_gmt;
      add_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
      if_modified_since off;
      expires off;
      etag off;
    paths:
      "/":
        backendServiceName: board
        backendServicePort: 8443

  Callbacks:
    blue:
      domain: callback.prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    paths:
      "/v2/callback/cryptoproviders/pss-provider-wtf2/":
        backendServiceName: processing
        backendServicePort: 8084
      "/ws/":
        backendServiceName: processing
        backendServicePort: 8086

  DashboardLegacy2:
    blue:
      domain: dashboard.cryptopay.band
      certSecretName: ingress-gate-api-dashboard
    nonblue:
      # Make final domain "dashboard-<HelmReleaseName>.prodcryptopay.kube" like a:
      #   dashboard-green.prodcryptopay.kube
      domainPerfix: dashboard-
      domainSuffix: .prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    nginxConfigurationSnippet: |
      add_header Last-Modified $date_gmt;
      add_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
      if_modified_since off;
      expires off;
      etag off;
    paths:
      "/":
        backendServiceName: dashboardlegacy2
        backendServicePort: 8443
      "/v2/dashboard/":
        backendServiceName: processing
        backendServicePort: 8082

  Gate:
    blue:
      domain: gate.pay-cex.io
      certSecretName: ingress-pay-cex-certificate
    nonblue:
      # Make final domain "gate-<HelmReleaseName>.prodcryptopay.kube" like a:
      #   gate-green.prodcryptopay.kube
      domainPerfix: gate-
      domainSuffix: .prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    backendInsecure: false
    nginxConfigurationSnippet: |
      add_header Last-Modified $date_gmt;
      add_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
      if_modified_since off;
      expires off;
      etag off;
    paths:
      "/":
        backendServiceName: processing
        backendServicePort: 8085
      "/v3/":
        backendServiceName: gatehostinternal
        backendServicePort: 8443
      # "/":
      #   backendServiceName: gateuiserve
      #   backendServicePort: 8080
      # "/v2/gate/":
      #   backendServiceName: processing
      #   backendServicePort: 8085
      # "/v2/gate-callback/":
      #   backendServiceName: processing
      #   backendServicePort: 8085

  Gatehostinternal:
    blue:
      domain: gate3.pay-cex.io
      certSecretName: dev
    backendInsecure: false
    nginxConfigurationSnippet: |
      add_header Last-Modified $date_gmt;
      add_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
      if_modified_since off;
      expires off;
      etag off;
    paths:
      "/":
        backendServiceName: gatehostinternal
        backendServicePort: 8443

  Identity:
    blue:
      domain: id.pay-cex.io
      certSecretName: ingress-pay-cex-certificate
    nonblue:
      # Make final domain "id-<HelmReleaseName>.prodcryptopay.kube" like a:
      #   id-green.prodcryptopay.kube
      domainPerfix: id-
      domainSuffix: .prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    paths:
      "/":
        backendServiceName: identity
        backendServicePort: 8443

  MessengerBridge:
    # THIS temporary endpoint just for testing purposes
    blue:
      domain: messengerbridge.prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    nonblue:
      # Make final domain "messengerbridge-<HelmReleaseName>.prodcryptopay.kube" like a:
      #   messengerbridge-green.prodcryptopay.kube
      domainPerfix: messengerbridge-
      domainSuffix: .prodcryptopay.kube
      certSecretName: wildcard-prodcryptopay-kube
    paths:
      "/":
        backendServiceName: messengerbridge
        backendServicePort: 8443
